<div class="container-fluid py-5" [@fadeIn]>
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10 col-xl-8">
      
      <!-- Success Message -->
      <div *ngIf="showSuccess" class="alert alert-success alert-dismissible fade show" 
           role="alert" [@slideInUp]>
        <div class="d-flex align-items-center">
          <i class="fas fa-check-circle me-2 fs-4"></i>
          <div>
            <h6 class="mb-1">Student Added Successfully!</h6>
            <small>Student has been registered and added to the system.</small>
          </div>
        </div>
      </div>

      <!-- Main Form Card -->
      <div class="card shadow-lg border-0 rounded-4 overflow-hidden" [@slideInUp]>
        
        <!-- Header -->
        <div class="card-header bg-gradient-primary text-white py-4">
          <div class="row align-items-center">
            <div class="col">
              <h3 class="mb-1 fw-bold">
                <i class="fas fa-user-graduate me-2"></i>Add New Student
              </h3>
              <p class="mb-0 opacity-75">Enter student details for registration</p>
            </div>
            <div class="col-auto">
              <div class="progress-circle">
                <span class="step-counter">{{ currentStep }}/{{ totalSteps }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress" style="height: 4px;">
          <div class="progress-bar bg-success" 
               [style.width.%]="(currentStep / totalSteps) * 100"
               [attr.aria-valuenow]="currentStep"
               aria-valuemin="0" 
               [attr.aria-valuemax]="totalSteps">
          </div>
        </div>

        <!-- Form Body -->
        <div class="card-body p-4 p-md-5">
          <form [formGroup]="studentForm" (ngSubmit)="onSubmit()" [@staggerAnimation]>
            
            <!-- Step 1: Personal & Academic Information -->
            <div *ngIf="currentStep === 1" class="step-content">
              <div class="row mb-4">
                <div class="col-12">
                  <h5 class="text-primary mb-3 fw-semibold">
                    <i class="fas fa-user me-2"></i>Personal & Academic Information
                  </h5>
                </div>
              </div>

              <div class="row g-3">
                <!-- Student Photo -->
                <div class="col-12 text-center mb-4">
                  <div class="photo-upload">
                    <div class="photo-placeholder">
                      <i class="fas fa-camera fa-2x text-muted"></i>
                      <p class="mt-2 mb-0 text-muted">Upload Photo</p>
                    </div>
                    <input type="file" 
                           class="form-control photo-input" 
                           accept="image/*"
                           (change)="onFileSelect($event)">
                  </div>
                </div>

                <!-- Name Fields -->
                <div class="col-md-6 form-group">
                  <label class="form-label fw-medium">First Name *</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-user"></i></span>
                    <input type="text" 
                           class="form-control"
                           formControlName="firstName"
                           placeholder="Enter first name"
                           [class.is-invalid]="isFieldInvalid('firstName')">
                  </div>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('firstName')">
                    First name is required (minimum 2 characters)
                  </div>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label fw-medium">Last Name *</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-user"></i></span>
                    <input type="text" 
                           class="form-control"
                           formControlName="lastName"
                           placeholder="Enter last name"
                           [class.is-invalid]="isFieldInvalid('lastName')">
                  </div>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('lastName')">
                    Last name is required (minimum 2 characters)
                  </div>
                </div>

                <!-- Student ID -->
                <div class="col-md-6 form-group">
                  <label class="form-label fw-medium">Student ID *</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-id-badge"></i></span>
                    <input type="text" 
                           class="form-control bg-light"
                           formControlName="studentId"
                           readonly>
                    <button type="button" 
                            class="btn btn-outline-secondary"
                            (click)="generateStudentId()"
                            title="Generate new ID">
                      <i class="fas fa-refresh"></i>
                    </button>
                  </div>
                </div>

                <!-- Date of Birth -->
                <div class="col-md-6 form-group">
                  <label class="form-label fw-medium">Date of Birth *</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                    <input type="date" 
                           class="form-control"
                           formControlName="dateOfBirth"
                           [class.is-invalid]="isFieldInvalid('dateOfBirth')">
                  </div>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('dateOfBirth')">
                    Date of birth is required
                  </div>
                </div>

                <!-- Gender -->
                <div class="col-md-6 form-group">
                  <label class="form-label fw-medium">Gender *</label>
                  <select class="form-select" 
                          formControlName="gender"
                          [class.is-invalid]="isFieldInvalid('gender')">
                    <option value="">Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                  </select>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('gender')">
                    Gender is required
                  </div>
                </div>

                <!-- Blood Group -->
                <div class="col-md-6 form-group">
                  <label class="form-label fw-medium">Blood Group</label>
                  <select class="form-select" formControlName="bloodGroup">
                    <option value="">Select Blood Group</option>
                    <option *ngFor="let bg of bloodGroups" [value]="bg">{{ bg }}</option>
                  </select>
                </div>

                <!-- Class -->
                <div class="col-md-4 form-group">
                  <label class="form-label fw-medium">Class *</label>
                  <select class="form-select" 
                          formControlName="class"
                          [class.is-invalid]="isFieldInvalid('class')">
                    <option value="">Select Class</option>
                    <option *ngFor="let cls of classes" [value]="cls">{{ cls }}</option>
                  </select>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('class')">
                    Class is required
                  </div>
                </div>

                <!-- Section -->
                <div class="col-md-4 form-group">
                  <label class="form-label fw-medium">Section *</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-layer-group"></i></span>
                    <input type="text" 
                           class="form-control text-uppercase"
                           formControlName="section"
                           placeholder="e.g., A"
                           maxlength="1"
                           [class.is-invalid]="isFieldInvalid('section')">
                  </div>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('section')">
                    Section is required (single letter)
                  </div>
                </div>

                <!-- Roll Number -->
                <div class="col-md-4 form-group">
                  <label class="form-label fw-medium">Roll Number *</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-hashtag"></i></span>
                    <input type="number" 
                           class="form-control"
                           formControlName="rollNumber"
                           placeholder="Enter roll number"
                           [class.is-invalid]="isFieldInvalid('rollNumber')">
                  </div>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('rollNumber')">
                    Roll number is required
                  </div>
                </div>

                <!-- Admission Date -->
                <div class="col-md-6 form-group">
                  <label class="form-label fw-medium">Admission Date *</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-calendar-plus"></i></span>
                    <input type="date" 
                           class="form-control"
                           formControlName="admissionDate"
                           [class.is-invalid]="isFieldInvalid('admissionDate')">
                  </div>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('admissionDate')">
                    Admission date is required
                  </div>
                </div>

                <!-- Previous School -->
                <div class="col-md-6 form-group">
                  <label class="form-label fw-medium">Previous School</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-school"></i></span>
                    <input type="text" 
                           class="form-control"
                           formControlName="previousSchool"
                           placeholder="Enter previous school name">
                  </div>
                </div>
              </div>
            </div>

            <!-- Step 2: Contact Information -->
            <div *ngIf="currentStep === 2" class="step-content">
              <div class="row mb-4">
                <div class="col-12">
                  <h5 class="text-primary mb-3 fw-semibold">
                    <i class="fas fa-address-book me-2"></i>Contact & Parent Information
                  </h5>
                </div>
              </div>

              <div class="row g-3">
                <!-- Student Contact -->
                <div class="col-12">
                  <h6 class="text-secondary mb-3">Student Contact Details</h6>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label fw-medium">Email</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                    <input type="email" 
                           class="form-control"
                           formControlName="email"
                           placeholder="student@example.com"
                           [class.is-invalid]="isFieldInvalid('email')">
                  </div>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('email')">
                    Please enter a valid email address
                  </div>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label fw-medium">Phone</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-phone"></i></span>
                    <input type="tel" 
                           class="form-control"
                           formControlName="phone"
                           placeholder="1234567890"
                           [class.is-invalid]="isFieldInvalid('phone')">
                  </div>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('phone')">
                    Please enter a valid 10-digit phone number
                  </div>
                </div>

                <!-- Address -->
                <div class="col-12 form-group">
                  <label class="form-label fw-medium">Address *</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-home"></i></span>
                    <textarea class="form-control" 
                              rows="2"
                              formControlName="address"
                              placeholder="Enter full address"
                              [class.is-invalid]="isFieldInvalid('address')"></textarea>
                  </div>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('address')">
                    Address is required
                  </div>
                </div>

                <div class="col-md-4 form-group">
                  <label class="form-label fw-medium">City *</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-city"></i></span>
                    <input type="text" 
                           class="form-control"
                           formControlName="city"
                           placeholder="Enter city"
                           [class.is-invalid]="isFieldInvalid('city')">
                  </div>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('city')">
                    City is required
                  </div>
                </div>

                <div class="col-md-4 form-group">
                  <label class="form-label fw-medium">State *</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-map"></i></span>
                    <input type="text" 
                           class="form-control"
                           formControlName="state"
                           placeholder="Enter state"
                           [class.is-invalid]="isFieldInvalid('state')">
                  </div>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('state')">
                    State is required
                  </div>
                </div>

                <div class="col-md-4 form-group">
                  <label class="form-label fw-medium">Pincode *</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-mail-bulk"></i></span>
                    <input type="text" 
                           class="form-control"
                           formControlName="pincode"
                           placeholder="123456"
                           maxlength="6"
                           [class.is-invalid]="isFieldInvalid('pincode')">
                  </div>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('pincode')">
                    Valid 6-digit pincode is required
                  </div>
                </div>

                <!-- Parent Information -->
                <div class="col-12 mt-4">
                  <h6 class="text-secondary mb-3">Parent/Guardian Information</h6>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label fw-medium">Parent/Guardian Name *</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-user-tie"></i></span>
                    <input type="text" 
                           class="form-control"
                           formControlName="parentName"
                           placeholder="Enter parent name"
                           [class.is-invalid]="isFieldInvalid('parentName')">
                  </div>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('parentName')">
                    Parent name is required
                  </div>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label fw-medium">Parent Phone *</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-phone"></i></span>
                    <input type="tel" 
                           class="form-control"
                           formControlName="parentPhone"
                           placeholder="1234567890"
                           [class.is-invalid]="isFieldInvalid('parentPhone')">
                  </div>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('parentPhone')">
                    Valid 10-digit parent phone is required
                  </div>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label fw-medium">Parent Email</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                    <input type="email" 
                           class="form-control"
                           formControlName="parentEmail"
                           placeholder="parent@example.com"
                           [class.is-invalid]="isFieldInvalid('parentEmail')">
                  </div>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('parentEmail')">
                    Please enter a valid email address
                  </div>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label fw-medium">Parent Occupation</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-briefcase"></i></span>
                    <input type="text" 
                           class="form-control"
                           formControlName="parentOccupation"
                           placeholder="Enter occupation">
                  </div>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label fw-medium">Emergency Contact *</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-exclamation-triangle"></i></span>
                    <input type="tel" 
                           class="form-control"
                           formControlName="emergencyContact"
                           placeholder="1234567890"
                           [class.is-invalid]="isFieldInvalid('emergencyContact')">
                  </div>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('emergencyContact')">
                    Emergency contact is required
                  </div>
                </div>
              </div>
            </div>

            <!-- Step 3: Fee & Facilities Information -->
            <div *ngIf="currentStep === 3" class="step-content">
              <div class="row mb-4">
                <div class="col-12">
                  <h5 class="text-primary mb-3 fw-semibold">
                    <i class="fas fa-rupee-sign me-2"></i>Fee & Facilities Information
                  </h5>
                </div>
              </div>

              <div class="row g-3">
                <div class="col-md-6 form-group">
                  <label class="form-label fw-medium">Fee Category *</label>
                  <select class="form-select" 
                          formControlName="feeCategory"
                          [class.is-invalid]="isFieldInvalid('feeCategory')">
                    <option value="Regular">Regular</option>
                    <option value="NRI">NRI</option>
                    <option value="Management">Management</option>
                  </select>
                </div>

                <div class="col-md-6 form-group">
                  <div class="form-check form-switch mt-4">
                    <input class="form-check-input" 
                           type="checkbox" 
                           formControlName="scholarship"
                           id="scholarshipSwitch">
                    <label class="form-check-label fw-medium" for="scholarshipSwitch">
                      Scholarship Applicable
                    </label>
                  </div>
                </div>

                <div class="col-md-6 form-group" *ngIf="studentForm.get('scholarship')?.value">
                  <label class="form-label fw-medium">Scholarship Percentage</label>
                  <div class="input-group">
                    <input type="number" 
                           class="form-control"
                           formControlName="scholarshipPercentage"
                           placeholder="0"
                           min="0"
                           max="100">
                    <span class="input-group-text">%</span>
                  </div>
                </div>

                <!-- Facilities -->
                <div class="col-12 mt-4">
                  <h6 class="text-secondary mb-3">Additional Facilities</h6>
                </div>

                <div class="col-md-6">
                  <div class="card border-0 bg-light h-100">
                    <div class="card-body text-center">
                      <i class="fas fa-bus fa-2x text-warning mb-2"></i>
                      <div class="form-check form-switch">
                        <input class="form-check-input" 
                               type="checkbox" 
                               formControlName="transportFacility"
                               id="transportSwitch">
                        <label class="form-check-label fw-medium" for="transportSwitch">
                          Transport Facility
                        </label>
                      </div>
                      <small class="text-muted">School bus service</small>
                    </div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="card border-0 bg-light h-100">
                    <div class="card-body text-center">
                      <i class="fas fa-bed fa-2x text-info mb-2"></i>
                      <div class="form-check form-switch">
                        <input class="form-check-input" 
                               type="checkbox" 
                               formControlName="hostelFacility"
                               id="hostelSwitch">
                        <label class="form-check-label fw-medium" for="hostelSwitch">
                          Hostel Facility
                        </label>
                      </div>
                      <small class="text-muted">Residential accommodation</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="row mt-5">
              <div class="col-12">
                <div class="d-flex justify-content-between">
                  <button type="button" 
                          class="btn btn-outline-secondary px-4"
                          (click)="prevStep()"
                          [disabled]="currentStep === 1">
                    <i class="fas fa-arrow-left me-2"></i>Previous
                  </button>

                  <div class="d-flex gap-2">
                    <button type="button" 
                            class="btn btn-primary px-4"
                            (click)="nextStep()"
                            *ngIf="currentStep < totalSteps"
                            [@buttonHover]="buttonState"
                            (mouseenter)="onMouseEnter()"
                            (mouseleave)="onMouseLeave()">
                      <span *ngIf="!isSubmitting">
                        <i class="fas fa-save me-2"></i>Add Student
                      </span>
                      <span *ngIf="isSubmitting">
                        <span class="spinner-border spinner-border-sm me-2"></span>
                        Adding...
                      </span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>